<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>AR Photo Scanner</title>

  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin:0; overflow:hidden; background:#000; }
    #loading {
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      color:white; font-family:sans-serif;
    }
  </style>
</head>

<body>

<div id="loading">ðŸ“¸ Point camera to photo...</div>

<a-scene
  mindar-image="imageTargetSrc: targets/targets.mind;"
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:false"
>
  <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>
</a-scene>

<script>
const scene = document.querySelector("a-scene");

fetch("events.json")
.then(r => r.json())
.then(events => {

  document.getElementById("loading").style.display="none";

  events.forEach((name, index) => {

    const entity = document.createElement("a-entity");
    entity.setAttribute("mindar-image-target", `targetIndex:${index}`);

    const video = document.createElement("a-video");
    video.setAttribute("src", `assets/${name}.mp4`);
    video.setAttribute("width","1");
    video.setAttribute("height","0.6");
    video.setAttribute("muted","");
    video.setAttribute("playsinline","");
    video.setAttribute("preload","none");

    entity.addEventListener("targetFound", ()=> video.play());
    entity.addEventListener("targetLost", ()=> video.pause());

    entity.appendChild(video);
    scene.appendChild(entity);
  });

});
</script>

</body>
</html>
